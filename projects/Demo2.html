<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ä¸€ä¸»é¢˜â€”ä¸‰å£°éƒ¨ï¼ˆHTML æ¼”ç¤ºï¼‰</title>
<style>
  :root{
    --bg:#0b1020; --card:#141b34; --ink:#e7ecff; --soft:#9fb5ff; --accent:#7bd389;
    --a:#ffd166; --b:#7bd389; --c:#9fb5ff;
  }
  *{box-sizing:border-box;font-family: ui-sans-serif, system-ui, "Segoe UI", Roboto, "PingFang SC", "Noto Sans CJK SC", Arial;}
  body{margin:0;background: radial-gradient(1200px 600px at 50% -10%,#1e2958 0%,#0b1020 60%); color:var(--ink);}
  .wrap{max-width:980px;margin:32px auto;padding:16px;}
  .title{display:flex;align-items:center;gap:12px;margin-bottom:8px}
  .badge{font-size:12px;padding:4px 8px;border-radius:999px;background:#223063;color:#bcd0ff;border:1px solid #2f3c77}
  .card{background:var(--card);border:1px solid #202a52;border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.35)}
  .hero{padding:18px 20px;margin-bottom:16px;display:flex;flex-direction:column;gap:10px}
  .hero h1{margin:0;font-size:22px;letter-spacing:.3px}
  .hero p{margin:0;color:#c9d6ffb0;font-size:14px;line-height:1.5}
  .theme-line{display:flex;gap:6px;align-items:center;flex-wrap:wrap}
  .pill{font-size:12px;padding:4px 10px;border-radius:999px;background:#1b2344;border:1px solid #2a3569;color:#cfe0ff}
  .grid{display:grid;grid-template-columns:130px 1fr;gap:0;border-top:1px solid #223063}
  .row{display:contents}
  .label{padding:14px 12px;border-bottom:1px solid #223063;background:#121833;color:#dfe7ff;font-weight:600}
  .track{position:relative;display:grid;grid-auto-flow:column;grid-auto-columns:minmax(28px,1fr);gap:8px;
         padding:10px 14px;border-bottom:1px solid #223063;align-items:center}
  .note{height:18px;border-radius:8px;opacity:.55;filter:saturate(120%)}
  .note.active{outline:2px solid #fff;opacity:1;box-shadow:0 0 12px rgba(255,255,255,.35)}
  .legend{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
  .controls{display:flex;flex-wrap:wrap;gap:10px;margin:14px 0}
  button, .toggle{background:#1b2448;color:#e9efff;border:1px solid #2b376e;border-radius:12px;padding:10px 14px;
                  cursor:pointer;font-weight:600}
  button:hover,.toggle:hover{filter:brightness(1.07)}
  .toggle[data-on="false"]{opacity:.45}
  .mini{font-size:12px;color:#c9d6ffb0;margin-top:8px;line-height:1.5}
  .foot{margin-top:16px;padding:12px 16px;border-left:3px solid #2b376e;background:rgba(18,24,51,.6);border-radius:12px}
  .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;color:#cfe0ff}
  /* voice colors */
  .vA .note{background: linear-gradient(180deg,#ffe08a,#ffcf5a); border:1px solid #e6b955}
  .vB .note{background: linear-gradient(180deg,#9ce9b1,#6fdc8f); border:1px solid #50c977}
  .vC .note{background: linear-gradient(180deg,#b8ccff,#9fb5ff); border:1px solid #7da0ff}
  /* scanning playhead line */
  .playhead{position:absolute;top:6px;bottom:6px;width:2px;background:linear-gradient(#fff,#cfe0ff);opacity:.9;
            box-shadow:0 0 8px rgba(255,255,255,.4);transform:translateX(0)}
  .sr{position:absolute;left:-9999px}
</style>
</head>
<body>
  <div class="wrap">
    <div class="title">
      <span class="badge">Trinity Analogy Â· HTML Demo</span>
      <span class="badge">One Theme â€” Three Parts</span>
    </div>

    <section class="card hero">
      <h1>ä¸€ä¸»é¢˜â€”ä¸‰å£°éƒ¨ï¼ˆOne Theme, Three Partsï¼‰</h1>
      <p>åŒä¸€â€œéŸ³ä¹ä¸»é¢˜â€ï¼ˆæ¯”å–»â€œä¸€æœ¬è´¨/ç¥æ€§â€ï¼‰åœ¨ä¸‰æ¡å¯åˆ†è¾¨çš„â€œå£°éƒ¨â€ï¼ˆæ¯”å–»ä¸‰â€œä½æ ¼â€ï¼šçˆ¶ã€å­ã€çµï¼‰é‡Œ
      <strong>åŒæ—¶</strong>å‘ˆç°ã€å½¼æ­¤å‘¼åº”ã€ç›¸äº’æˆå…¨ï¼šæ—¢æœ‰<strong>åˆä¸€</strong>ï¼Œä¹Ÿæœ‰<strong>åŒºåˆ†</strong>ï¼Œå¹¶åœ¨ç»Ÿä¸€çš„æ€»æ§ä¸‹<strong>ä¸å¯åˆ†åœ°åä½œ</strong>ã€‚</p>
      <div class="theme-line">
        <span class="pill">One Themeï¼ˆæ—‹å¾‹ä¸»é¢˜ï¼‰</span>
        <span class="pill">åŒèµ·åŒæ­¢ï¼ˆSimultaneityï¼‰</span>
        <span class="pill">å¯åˆ†è¾¨çš„å£°éƒ¨ç‰¹å¾ï¼ˆTimbre/Pan/Octaveï¼‰</span>
        <span class="pill">ç»Ÿä¸€æ€»æ§ï¼ˆInseparable Operationsï¼‰</span>
      </div>

      <div class="controls">
        <button id="playBtn" aria-pressed="false">â–¶ï¸ æ’­æ”¾</button>
        <button id="pauseBtn">â¸ æš‚åœ</button>
        <button id="resetBtn">âŸ² é‡ç½®</button>

        <span class="sr" id="live" role="status" aria-live="polite"></span>

        <button class="toggle" id="muteA" data-on="true">A å£°éƒ¨ï¼ˆâ€œçˆ¶â€ï¼‰ğŸ”Š</button>
        <button class="toggle" id="muteB" data-on="true">B å£°éƒ¨ï¼ˆâ€œå­â€ï¼‰ğŸ”Š</button>
        <button class="toggle" id="muteC" data-on="true">C å£°éƒ¨ï¼ˆâ€œçµâ€ï¼‰ğŸ”Š</button>
      </div>

      <p class="mini">
        æ³¨ï¼šè¿™æ˜¯â€œ<em>ç±»æ¯”</em>â€ä¸â€œ<em>ç¤ºèŒƒé“å…·</em>â€ï¼Œä¸æ˜¯ç­‰å¼ã€‚éŸ³ä¹æ²¡æœ‰ä½æ ¼ï¼›ä¸‰ä½å´æ˜¯â€œè°â€ï¼Œèƒ½ç›¸çˆ±ã€å·®æ´¾ã€åº”è®¸ã€‚
        ä¸‰å£°éƒ¨ä¸æ˜¯â€œä¸‰åˆ†ä¹‹ä¸€â€ï¼Œè€Œæ˜¯åŒä¸€ä¸»é¢˜åœ¨ä¸åŒä½ä¸Š<strong>å®Œå…¨</strong>ã€åŒæ—¶çš„å‘ˆç°ï¼›ä¸æ˜¯ä¸‰é¦–æ­Œå¹¶æ’ï¼Œè€Œæ˜¯ä¸€é¦–æ­Œã€‚
      </p>
    </section>

    <section class="card">
      <div class="grid" id="tracks">
        <div class="row">
          <div class="label">ä¸»é¢˜ï¼ˆç®€è°±ï¼‰</div>
          <div class="track" id="themeTrack"></div>
        </div>
        <div class="row vA">
          <div class="label">A å£°éƒ¨ï¼ˆâ€œçˆ¶â€ï¼‰</div>
          <div class="track" id="trackA"><div class="playhead" aria-hidden="true"></div></div>
        </div>
        <div class="row vB">
          <div class="label">B å£°éƒ¨ï¼ˆâ€œå­â€ï¼‰</div>
          <div class="track" id="trackB"><div class="playhead" aria-hidden="true"></div></div>
        </div>
        <div class="row vC">
          <div class="label">C å£°éƒ¨ï¼ˆâ€œçµâ€ï¼‰</div>
          <div class="track" id="trackC"><div class="playhead" aria-hidden="true"></div></div>
        </div>
      </div>
      <div class="foot">
        <div class="legend">
          <span class="pill">åŒºåˆ†ï¼šAï¼ˆå·¦å£°åƒï¼Œä½å…«åº¦ï¼Œåœ†æ»‘ï¼‰ã€Bï¼ˆä¸­ç½®ï¼Œè½»ä¸‰è§’æ³¢ï¼‰ã€Cï¼ˆå³å£°åƒï¼Œå¸¦å¾®é¢¤åŠ¨ï¼‰</span>
          <span class="pill">åˆä¸€ï¼šä¸‰è€…æ¼”åŒä¸€ä¸»é¢˜ï¼ˆåŒä¸€éŸ³é«˜åºåˆ—ï¼‰ï¼ŒåŒèµ·åŒæ­¢</span>
          <span class="pill">åä½œï¼šç»Ÿä¸€æ—¶é’Ÿé©±åŠ¨ï¼›é™éŸ³ä¸ä¼šåœæ­¢å…¨æ›²</span>
        </div>
        <div class="mini mono">æç¤ºï¼šè‹¥æ²¡æœ‰å£°éŸ³ï¼Œè¯·ä¸æµè§ˆå™¨äº¤äº’åå†ç‚¹â€œæ’­æ”¾â€ï¼›å»ºè®®ä½©æˆ´è€³æœºæ„Ÿå—å·¦å³å£°åƒçš„åŒºåˆ†ã€‚</div>
      </div>
    </section>
  </div>

<script>
/* ========= åŸºæœ¬æ•°æ®ï¼šä¸»é¢˜ï¼ˆç›¸å¯¹éŸ³é«˜ï¼‰ =========
   è¿™é‡Œå®šä¹‰â€œåŒä¸€ä¸»é¢˜â€çš„éŸ³çº§åºåˆ—ï¼ˆä»¥åŠéŸ³ä¸ºå•ä½çš„ç›¸å¯¹ä½ç§»ï¼‰ã€‚
   ä¾‹ï¼šå¤§è°ƒåŠ¨æœº [0,2,4,5,7,5,4,2,0]ï¼Œæ¯ä¸ªéŸ³æ—¶å€¼ç›¸åŒã€‚ */
var THEME_STEPS = [0,2,4,5,7,5,4,2,0,  0,2,4,5,7,5,4,2]; // 16 æ‹
var STEP_SEC = 0.5; // æ¯æ‹ 0.5 ç§’
var BASE_FREQ = 261.63; // C4

/* ========= Web Audio è®¾ç½® ========= */
var ctx, masterGain, transport = null, stepIndex = 0, isRunning = false;
var voiceA = {}, voiceB = {}, voiceC = {};
var muteA = false, muteB = false, muteC = false;

/* å·¥å…·ï¼šåŠéŸ³ä½ç§»åˆ°é¢‘ç‡ï¼ˆåäºŒå¹³å‡å¾‹ï¼‰ */
function semitoneToFreq(baseFreq, semitoneOffset){
  return baseFreq * Math.pow(2, semitoneOffset/12);
}

/* åˆ›å»ºä¸€ä¸ªå£°éƒ¨ï¼ˆå¸¦å£°åƒã€éŸ³è‰²ä¸å¯é€‰é¢¤éŸ³ï¼‰ */
function createVoice(panValue, octaveShift, type, vibrato){
  var v = {};
  v.gain = ctx.createGain(); v.gain.gain.value = 0.18;
  v.pan = ctx.createStereoPanner(); v.pan.pan.value = panValue;
  v.vibrato = null; v.vibratoGain = null;

  if(vibrato){
    v.vibrato = ctx.createOscillator();
    v.vibrato.frequency.value = vibrato.rate; // Hz
    v.vibratoGain = ctx.createGain();
    v.vibratoGain.gain.value = vibrato.depth; // é¢¤éŸ³æ·±åº¦ï¼ˆHz è½¬æ¢åæ˜ å°„åˆ° detuneï¼‰
  }

  v.playNote = function(freq, t, dur){
    var osc = ctx.createOscillator();
    osc.type = type;
    // é¢¤éŸ³é€šè¿‡ detuneï¼ˆcentsï¼‰å®ç°ï¼šdepth(Hz) è¿‘ä¼¼æ¢ç®—æˆ cents
    if(v.vibrato){
      var vibratoToDetune = ctx.createGain();
      vibratoToDetune.gain.value = 100; // é€‚ä¸­
      v.vibrato.connect(vibratoToDetune).connect(osc.detune);
    }
    osc.frequency.setValueAtTime(freq * Math.pow(2, octaveShift), t);

    var g = ctx.createGain();
    // ADSRï¼ˆæç®€ï¼‰ï¼šattack 0.01s -> sustain -> release 0.06s
    g.gain.setValueAtTime(0.0001, t);
    g.gain.exponentialRampToValueAtTime(1.0, t + 0.01);
    g.gain.exponentialRampToValueAtTime(0.35, t + Math.max(0.05, dur - 0.08));
    g.gain.linearRampToValueAtTime(0.0001, t + dur);

    osc.connect(g).connect(v.gain).connect(v.pan).connect(masterGain);
    osc.start(t);
    osc.stop(t + dur + 0.02);
    return osc;
  };
  if(v.vibrato){ v.vibrato.start(); }
  return v;
}

/* ========= è§†è§‰è½¨é“ ========= */
function buildTrack(containerId, colorClass){
  var track = document.getElementById(containerId);
  track.innerHTML = "";
  for(var i=0;i<THEME_STEPS.length;i++){
    var d = document.createElement("div");
    d.className = "note";
    track.appendChild(d);
  }
  return track;
}
var themeTrackEl, trackAEl, trackBEl, trackCEl;

function setActive(trackEl, index){
  var nodes = trackEl.querySelectorAll(".note");
  for(var i=0;i<nodes.length;i++){
    nodes[i].classList.toggle("active", i===index);
  }
}

/* æ’­æ”¾å¤´ä½ç½®ï¼ˆè§†è§‰ï¼‰ */
function updatePlayheads(){
  var t = stepIndex;
  var cols = THEME_STEPS.length;
  function move(line){
    var ph = line.querySelector(".playhead");
    if(!ph) return;
    var notes = line.querySelectorAll(".note");
    if(notes.length===0) return;
    var hostRect = line.getBoundingClientRect(), first = notes[0].getBoundingClientRect(), last = notes[notes.length-1].getBoundingClientRect();
    var x = first.left + (last.right - first.left) * (t/(cols-1));
    ph.style.transform = "translateX(" + (x - hostRect.left) + "px)";
  }
  move(trackAEl); move(trackBEl); move(trackCEl);
}

/* ========= ç»Ÿä¸€çš„èŠ‚æ‹å™¨/æ€»æ§ ========= */
function schedulerTick(){
  var now = ctx.currentTime;
  var startTime = now + 0.05; // è½»å¾®æå‰è°ƒåº¦
  var stepDur = STEP_SEC;

  var rel = THEME_STEPS[stepIndex];
  var freq = semitoneToFreq(BASE_FREQ, rel);

  if(!muteA){ voiceA.playNote(freq, startTime, stepDur*0.98); }
  if(!muteB){ voiceB.playNote(freq, startTime, stepDur*0.98); }
  if(!muteC){ voiceC.playNote(freq, startTime, stepDur*0.98); }

  setActive(themeTrackEl, stepIndex);
  setActive(trackAEl, stepIndex);
  setActive(trackBEl, stepIndex);
  setActive(trackCEl, stepIndex);
  updatePlayheads();

  stepIndex = (stepIndex + 1) % THEME_STEPS.length;
}

/* å¼€å§‹ã€æš‚åœã€é‡ç½® */
function startTransport(){
  if(isRunning) return;
  isRunning = true;
  document.getElementById("playBtn").setAttribute("aria-pressed","true");
  transport = setInterval(schedulerTick, STEP_SEC*1000);
  announce("æ’­æ”¾ä¸­ï¼šç»Ÿä¸€æ—¶é’Ÿé©±åŠ¨ä¸‰å£°éƒ¨åŒæ—¶å‰è¿›ã€‚");
}
function pauseTransport(){
  if(!isRunning) return;
  clearInterval(transport); transport = null; isRunning = false;
  document.getElementById("playBtn").setAttribute("aria-pressed","false");
  announce("å·²æš‚åœã€‚");
}
function resetTransport(){
  pauseTransport();
  stepIndex = 0;
  setActive(themeTrackEl, -1);
  setActive(trackAEl, -1);
  setActive(trackBEl, -1);
  setActive(trackCEl, -1);
  updatePlayheads();
  announce("å·²é‡ç½®åˆ°èµ·ç‚¹ã€‚");
}

/* æ— éšœç¢å®æ—¶æç¤º */
function announce(msg){
  var live = document.getElementById("live");
  live.textContent = msg;
}

/* ========= åˆå§‹åŒ– ========= */
function init(){
  // ç”»ä¸»é¢˜ä¸ä¸‰è½¨
  themeTrackEl = buildTrack("themeTrack");
  trackAEl = buildTrack("trackA");
  trackBEl = buildTrack("trackB");
  trackCEl = buildTrack("trackC");

  // æ‡’åŠ è½½ AudioContextï¼ˆéœ€ç”¨æˆ·æ‰‹åŠ¿ï¼‰
  if(!ctx){
    ctx = new (window.AudioContext || window.webkitAudioContext)();
    masterGain = ctx.createGain();
    masterGain.gain.value = 0.8;
    masterGain.connect(ctx.destination);

    // ä¸‰å£°éƒ¨ï¼šä¸åŒå£°åƒ/éŸ³åŒº/éŸ³è‰²/æ˜¯å¦é¢¤éŸ³
    voiceA = createVoice(-0.6, -1, "sine", null);                 // å·¦ã€ä½å…«åº¦ã€åœ†æ»‘
    voiceB = createVoice( 0.0,  0, "triangle", null);             // ä¸­ç½®ã€åŸä½ã€ä¸‰è§’æ³¢
    voiceC = createVoice( 0.6, -2, "sine", {rate:5.5, depth:6});  // å³ã€ä½ä¸¤åº¦ã€è½»é¢¤éŸ³
  }

  // æ§ä»¶
  document.getElementById("playBtn").onclick = function(){ ctx.resume(); startTransport(); };
  document.getElementById("pauseBtn").onclick = function(){ pauseTransport(); };
  document.getElementById("resetBtn").onclick = function(){ resetTransport(); };

  function bindMute(btnId, which){
    var el = document.getElementById(btnId);
    el.onclick = function(){
      var on = el.getAttribute("data-on")==="true";
      on = !on;
      el.setAttribute("data-on", on ? "true":"false");
      if(which==="A"){ muteA = !on; el.textContent = on ? "A å£°éƒ¨ï¼ˆâ€œçˆ¶â€ï¼‰ğŸ”Š" : "A å£°éƒ¨ï¼ˆâ€œçˆ¶â€ï¼‰ğŸ”‡"; }
      if(which==="B"){ muteB = !on; el.textContent = on ? "B å£°éƒ¨ï¼ˆâ€œå­â€ï¼‰ğŸ”Š" : "B å£°éƒ¨ï¼ˆâ€œå­â€ï¼‰ğŸ”‡"; }
      if(which==="C"){ muteC = !on; el.textContent = on ? "C å£°éƒ¨ï¼ˆâ€œçµâ€ï¼‰ğŸ”Š" : "C å£°éƒ¨ï¼ˆâ€œçµâ€ï¼‰ğŸ”‡"; }
    };
  }
  bindMute("muteA","A"); bindMute("muteB","B"); bindMute("muteC","C");

  resetTransport();
}

window.addEventListener("load", init);
</script>
</body>
</html>
